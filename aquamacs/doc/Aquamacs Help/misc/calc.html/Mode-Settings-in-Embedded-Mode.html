<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<!-- This file documents Calc, the GNU Emacs calculator, included with
GNU Emacs 25.1.

Copyright (C) 1990-1991, 2001-2016 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with the
Invariant Sections being just "GNU GENERAL PUBLIC LICENSE", with the
Front-Cover Texts being "A GNU Manual," and with the Back-Cover
Texts as in (a) below.  A copy of the license is included in the section
entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual." -->
<!-- Created by GNU Texinfo 5.2, http://www.gnu.org/software/texinfo/ -->

<head>
  <meta name="generator" content=
  "HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.18.1), see www.w3.org" />

  <title>GNU Emacs Calc Manual: Mode Settings in Embedded
  Mode</title>
  <meta name="description" content=
  "GNU Emacs Calc Manual: Mode Settings in Embedded Mode" />
  <meta name="keywords" content=
  "GNU Emacs Calc Manual: Mode Settings in Embedded Mode" />
  <meta name="resource-type" content="document" />
  <meta name="distribution" content="global" />
  <meta name="Generator" content="makeinfo" />
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii" />
  <link href="index.html#Top" rel="start" title="Top" />
  <link href="Key-Index.html#Key-Index" rel="index" title=
  "Key Index" />
  <link href="index.html#SEC_Contents" rel="contents" title=
  "Table of Contents" />
  <link href="Embedded-Mode.html#Embedded-Mode" rel="up" title=
  "Embedded Mode" />
  <link href=
  "Customizing-Embedded-Mode.html#Customizing-Embedded-Mode" rel=
  "next" title="Customizing Embedded Mode" />
  <link href=
  "Assignments-in-Embedded-Mode.html#Assignments-in-Embedded-Mode"
  rel="prev" title="Assignments in Embedded Mode" />
  <style type="text/css">
/*<![CDATA[*/
  <!--
  a.summary-letter {text-decoration: none}
  blockquote.smallquotation {font-size: smaller}
  div.display {margin-left: 3.2em}
  div.example {margin-left: 3.2em}
  div.indentedblock {margin-left: 3.2em}
  div.lisp {margin-left: 3.2em}
  div.smalldisplay {margin-left: 3.2em}
  div.smallexample {margin-left: 3.2em}
  div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
  div.smalllisp {margin-left: 3.2em}
  kbd {font-style:oblique}
  pre.display {font-family: inherit}
  pre.format {font-family: inherit}
  pre.menu-comment {font-family: serif}
  pre.menu-preformatted {font-family: serif}
  pre.smalldisplay {font-family: inherit; font-size: smaller}
  pre.smallexample {font-size: smaller}
  pre.smallformat {font-family: inherit; font-size: smaller}
  pre.smalllisp {font-size: smaller}
  span.nocodebreak {white-space:nowrap}
  span.nolinebreak {white-space:nowrap}
  span.roman {font-family:serif; font-weight:normal}
  span.sansserif {font-family:sans-serif; font-weight:normal}
  ul.no-bullet {list-style: none}
  -->
  /*]]>*/
  </style>
  <style type="text/css">
/*<![CDATA[*/
  body {
  background-color: #FFFFFF;
  color: #000000;
  }
  :link { color: #0000FF }
  :visited { color: #800080 }
  :active { color: #FF0000 }
  /*]]>*/
  </style>
</head>

<body lang="en" xml:lang="en">
  <a name="Mode-Settings-in-Embedded-Mode" id=
  "Mode-Settings-in-Embedded-Mode"></a>

  <div class="header">
    <p>Next: <a href=
    "Customizing-Embedded-Mode.html#Customizing-Embedded-Mode"
    accesskey="n" rel="next">Customizing Embedded Mode</a>,
    Previous: <a href=
    "Assignments-in-Embedded-Mode.html#Assignments-in-Embedded-Mode"
    accesskey="p" rel="prev">Assignments in Embedded Mode</a>, Up:
    <a href="Embedded-Mode.html#Embedded-Mode" accesskey="u" rel=
    "up">Embedded Mode</a> &nbsp; [<a href=
    "index.html#SEC_Contents" title="Table of contents" rel=
    "contents">Contents</a>][<a href="Key-Index.html#Key-Index"
    title="Index" rel="index">Index</a>]</p>
  </div>
  <hr />
  <a name="Mode-Settings-in-Embedded-Mode-1" id=
  "Mode-Settings-in-Embedded-Mode-1"></a>

  <h3 class="section">16.4 Mode Settings in Embedded
  Mode</h3><a name="index-m-e" id="index-m-e"></a> <a name=
  "index-calc_002dembedded_002dpreserve_002dmodes" id=
  "index-calc_002dembedded_002dpreserve_002dmodes"></a>

  <p>The mode settings can be changed while Calc is in embedded
  mode, but by default they will revert to their original values
  when embedded mode is ended. However, the modes saved when the
  mode-recording mode is <code>Save</code> (see below) and the
  modes in effect when the <kbd>m e</kbd>
  (<code>calc-embedded-preserve-modes</code>) command is given will
  be preserved when embedded mode is ended.</p>

  <p>Embedded mode has a rather complicated mechanism for handling
  mode settings in Embedded formulas. It is possible to put
  annotations in the file that specify mode settings either global
  to the entire file or local to a particular formula or formulas.
  In the latter case, different modes can be specified for use when
  a formula is the enabled Embedded mode formula.</p>

  <p>When you give any mode-setting command, like <kbd>m f</kbd>
  (for Fraction mode) or <kbd>d s</kbd> (for scientific notation),
  Embedded mode adds a line like the following one to the file just
  before the opening delimiter of the formula.</p>

  <div class="example">
    <pre class="example">
% [calc-mode: fractions: t]
% [calc-mode: float-format: (sci 0)]
</pre>
  </div>

  <p>When Calc interprets an embedded formula, it scans the text
  before the formula for mode-setting annotations like these and
  sets the Calc buffer to match these modes. Modes not explicitly
  described in the file are not changed. Calc scans all the way to
  the top of the file, or up to a line of the form</p>

  <div class="example">
    <pre class="example">
% [calc-defaults]
</pre>
  </div>

  <p>which you can insert at strategic places in the file if this
  backward scan is getting too slow, or just to provide a barrier
  between one &ldquo;zone&rdquo; of mode settings and another.</p>

  <p>If the file contains several annotations for the same mode,
  the closest one before the formula is used. Annotations after the
  formula are never used (except for global annotations, described
  below).</p>

  <p>The scan does not look for the leading &lsquo;<samp>%</samp>
  &rsquo;, only for the square brackets and the text they enclose.
  In fact, the leading characters are different for different major
  modes. You can edit the mode annotations to a style that works
  better in context if you wish. See <a href=
  "Customizing-Embedded-Mode.html#Customizing-Embedded-Mode">Customizing
  Embedded Mode</a>, to see how to change the style that Calc uses
  when it generates the annotations. You can write mode annotations
  into the file yourself if you know the syntax; the easiest way to
  find the syntax for a given mode is to let Calc write the
  annotation for it once and see what it does.</p>

  <p>If you give a mode-changing command for a mode that already
  has a suitable annotation just above the current formula, Calc
  will modify that annotation rather than generating a new,
  conflicting one.</p>

  <p>Mode annotations have three parts, separated by colons.
  (Spaces after the colons are optional.) The first identifies the
  kind of mode setting, the second is a name for the mode itself,
  and the third is the value in the form of a Lisp symbol, number,
  or list. Annotations with unrecognizable text in the first or
  second parts are ignored. The third part is not checked to make
  sure the value is of a valid type or range; if you write an
  annotation by hand, be sure to give a proper value or results
  will be unpredictable. Mode-setting annotations are
  case-sensitive.</p>

  <p>While Embedded mode is enabled, the word <code>Local</code>
  appears in the mode line. This is to show that mode setting
  commands generate annotations that are &ldquo;local&rdquo; to the
  current formula or set of formulas. The <kbd>m R</kbd>
  (<code>calc-mode-record-mode</code>) command causes Calc to
  generate different kinds of annotations. Pressing <kbd>m R</kbd>
  repeatedly cycles through the possible modes.</p>

  <p><code>LocEdit</code> and <code>LocPerm</code> modes generate
  annotations that look like this, respectively:</p>

  <div class="example">
    <pre class="example">
% [calc-edit-mode: float-format: (sci 0)]
% [calc-perm-mode: float-format: (sci 5)]
</pre>
  </div>

  <p>The first kind of annotation will be used only while a formula
  is enabled in Embedded mode. The second kind will be used only
  when the formula is <em>not</em> enabled. (Whether the formula is
  &ldquo;active&rdquo; or not, i.e., whether Calc has seen this
  formula yet, is not relevant here.)</p>

  <p><code>Global</code> mode generates an annotation like this at
  the end of the file:</p>

  <div class="example">
    <pre class="example">
% [calc-global-mode: fractions t]
</pre>
  </div>

  <p>Global mode annotations affect all formulas throughout the
  file, and may appear anywhere in the file. This allows you to
  tuck your mode annotations somewhere out of the way, say, on a
  new page of the file, as long as those mode settings are suitable
  for all formulas in the file.</p>

  <p>Enabling a formula with <kbd>C-x * e</kbd> causes a fresh scan
  for local mode annotations; you will have to use this after
  adding annotations above a formula by hand to get the formula to
  notice them. Updating a formula with <kbd>C-x * u</kbd> will also
  re-scan the local modes, but global modes are only re-scanned by
  <kbd>C-x * a</kbd>.</p>

  <p>Another way that modes can get out of date is if you add a
  local mode annotation to a formula that has another formula after
  it. In this example, we have used the <kbd>d s</kbd> command
  while the first of the two embedded formulas is active. But the
  second formula has not changed its style to match, even though by
  the rules of reading annotations the &lsquo;<samp>(sci
  0)</samp>&rsquo; applies to it, too.</p>

  <div class="example">
    <pre class="example">
% [calc-mode: float-format: (sci 0)]
1.23e2

456.
</pre>
  </div>

  <p>We would have to go down to the other formula and press
  <kbd>C-x * u</kbd> on it in order to get it to notice the new
  annotation.</p>

  <p>Two more mode-recording modes selectable by <kbd>m R</kbd> are
  available which are also available outside of Embedded mode. (see
  <a href=
  "General-Mode-Commands.html#General-Mode-Commands">General Mode
  Commands</a>.) They are <code>Save</code>, in which mode settings
  are recorded permanently in your Calc init file (the file given
  by the variable <code>calc-settings-file</code>, typically
  <samp>~/.emacs.d/calc.el</samp>) rather than by annotating the
  current document, and no-recording mode (where there is no symbol
  like <code>Save</code> or <code>Local</code> in the mode line),
  in which mode-changing commands do not leave any annotations at
  all.</p>

  <p>When Embedded mode is not enabled, mode-recording modes except
  for <code>Save</code> have no effect.</p>
  <hr />

  <div class="header">
    <p>Next: <a href=
    "Customizing-Embedded-Mode.html#Customizing-Embedded-Mode"
    accesskey="n" rel="next">Customizing Embedded Mode</a>,
    Previous: <a href=
    "Assignments-in-Embedded-Mode.html#Assignments-in-Embedded-Mode"
    accesskey="p" rel="prev">Assignments in Embedded Mode</a>, Up:
    <a href="Embedded-Mode.html#Embedded-Mode" accesskey="u" rel=
    "up">Embedded Mode</a> &nbsp; [<a href=
    "index.html#SEC_Contents" title="Table of contents" rel=
    "contents">Contents</a>][<a href="Key-Index.html#Key-Index"
    title="Index" rel="index">Index</a>]</p>
  </div>
</body>
</html>
